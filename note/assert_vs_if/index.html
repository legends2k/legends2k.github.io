

<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Assertions vs if checks &middot; Sundaram Ramaswamy</title>
        <meta name="description" content="Two completely unrelated concepts">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.103.1" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="icon" href="/images/pencil-square-o.svg" sizes="any" type="image/svg+xml">
        <meta property="og:title" content="Assertions vs if checks">
<meta property="og:description" content="Two completely unrelated concepts">
<meta property="og:type" content="article">
<meta property="og:url" content="https://legends2k.github.io/note/assert_vs_if/">
        <link rel="stylesheet" href="https://legends2k.github.io/dist/styles.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/2.5.0/hint.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        
        
        
        
        </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <a class="button-square hint--top hint--rounded hint--bounce" aria-label="Home" title="Home" href="https://legends2k.github.io/" rel="me">
                                <i class="fa fa-home"></i>
                            </a>
                        
                        <a class="button-square hint--top hint--rounded hint--bounce"
                           aria-label="RSS Feed" title="RSS Feed" href="https://legends2k.github.io/index.xml"><i class="fa fa-rss"></i></a>
                        
                        
                        
                            <a class="button-square hint--top hint--rounded hint--bounce" aria-label="Github" title="Github" href="https://github.com/legends2k" rel="me">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                            <a class="button-square hint--top hint--rounded hint--bounce" aria-label="Bitbucket" title="Bitbucket" href="https://bitbucket.org/rmsundaram" rel="me">
                                <i class="fa fa-bitbucket"></i>
                            </a>
                        
                        
                            <a class="button-square hint--top hint--rounded hint--bounce" aria-label="Stack Overflow" title="Stack Overflow" href="https://stackoverflow.com/users/183120/legends2k" rel="me">
                                <i class="fa fa-stack-overflow"></i>
                            </a>
                        
                        
                            <a class="button-square hint--top hint--rounded hint--bounce" aria-label="LinkedIn" title="LinkedIn" href="https://in.linkedin.com/pub/sundaram-ramaswamy/24/b20/1a0" rel="me">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                        
                            <a class="button-square hint--top hint--rounded hint--bounce" aria-label="Flickr" title="Flickr" href="https://flickr.com/photos/legends2k" rel="me">
                                <i class="fa fa-flickr"></i>
                            </a>
                        
                        
                            <a class="button-square hint--top hint--rounded hint--bounce" aria-label="Email" title="Email" href="mailto:legends2k@yahoo.com">
                                <i class="fa fa-envelope"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a href="/post/">Posts</a>
    </li>

    <li class="site-nav-item">
        <a href="/note/">Notes</a>
    </li>

    <li class="site-nav-item">
        <a href="/projects/">Projects</a>
    </li>

    <li class="site-nav-item">
        <a href="/about/">About</a>
    </li>


                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Assertions vs if checks</h1>
    
        <p class="post-description" itemprop="description">Two completely unrelated concepts</p>
    
    <p class="post-date">
    Published <time datetime="2021-10-13" itemprop="datePublished">Oct 13, 2021</time>
    <span>by</span>
    <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
        <span itemprop="name">
            <a href="https://legends2k.github.io/about/" itemprop="url" rel="author">Sundaram Ramaswamy</a>
        </span>
    </span>
    
    <span class="post-update-date">
        Updated <time datetime="2021-10-13" itemprop="datePublished">Jan 24, 2022</time>
    </span>
    
</p>

    
    
</header>


        <div class="post-content clearfix" itemprop="articleBody">
    

    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
TL;DR
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
  Any program can have two classes of issues:</p>
<ol>
<li><strong>Runtime problems</strong>: situations programmer foresaw and handled; <em>expected</em>.  E.g. invalid inputs, no access to resource, unreachable network, …</li>
<li><strong>Bugs</strong>: programmer mistakes; <em>unexpected</em>.  E.g. <a href="https://en.wikipedia.org/wiki/Buffer_overflow">buffer overflow</a>, access violation, …</li>
</ol>
<p>There are different tools to deal with each; don’t conflate one with the other.</p>
<blockquote>
<p>An assertion is just a validation of a programmer expectation; it “fires” when the expectation is betrayed.</p>
</blockquote>
<p>
(1) is familiar to most; use one of your language-provided feature including <code>if</code>, <code>try-catch-throw</code>, etc. that work at <em>runtime</em>.  (2) needs early spotting of failing assumptions, changing invariants, unmet pre-/post-conditions at <em>development-time</em><sup class="footnote-reference"><a id="footnote-reference-1" href="#footnote-1">1</a></sup>.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Assertions
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<figure>
<div class="src src-c++">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">read_image</span>(string path) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">!</span>os.exists(path) {                <span style="color:#6272a4">// (1) runtime issue
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    file_missing_dialog.show(path);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  Image i <span style="color:#ff79c6">=</span> open_image(path);
</span></span><span style="display:flex;"><span>  REQUIRE(i.resource_id <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nullptr</span>,    <span style="color:#6272a4">// (2) possible bug in open_image
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          <span style="color:#f1fa8c">&#34;Resource ID unassigned for opened image&#34;</span>);
</span></span><span style="display:flex;"><span>  cache(r.resource_id);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</div>
<figcaption>
<strong>Example</strong>: Using <code>REQUIRE</code> to check resource ID generation by <code>open_image</code>
</figcaption>
</figure>
<p>
  With asserts you’re checking your own code for possible bugs.  In the above code we try to cache the most recently opened image with its resource ID; before doing so we make sure such an internal ID was properly assigned to the opened image with a <code>REQUIRE</code> <em>macro</em>.  This check will be stripped from the final, released binary.  It’d only exist in debug builds which developers and testers would use.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Aren’t assertions <code>if</code>-s anyway?
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>
  Though asserts are made of <code>if</code> statements, that’s true only for debug builds; they don’t <em>fire</em> on non-debug builds<sup class="footnote-reference"><a id="footnote-reference-2" href="#footnote-2">2</a></sup>.  C and C++ have a preprocessor stage, so most codebases define some assertion macro which compile to a <a href="https://en.wikipedia.org/wiki/NOP_(code)">no-op</a> on non-debug builds and on a debug build – run by the developer or tester – define it as valid <code>if</code>; upon firing, an assertion helps the developer better understand the issue e.g. log a message, invoke the debugger<sup class="footnote-reference"><a id="footnote-reference-3" href="#footnote-3">3</a></sup>, etc.</p>
<div class="src src-c">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">#ifdef NDEBUG          </span><span style="color:#6272a4">// usually defined for non-debug builds
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">#  define REQUIRE(expr, msg) ((void) expr)            </span><span style="color:#6272a4">// no-op
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">#else
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#  define REQUIRE(expr, msg) if (expr) {                     \
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">                               std::cerr &lt;&lt; __FILE__ &lt;&lt; &#39;:&#39;  \
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">                                         &lt;&lt; __LINE__ &lt;&lt; &#34;: &#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">                                         &lt;&lt; msg;             \
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#fi</span></span></span></code></pre></div>
</div>
<p>
  You can have a variety of assertion macros like <code>REQUIRE</code>, <code>DCHECK</code><sup class="footnote-reference"><a id="footnote-reference-4" href="#footnote-4">4</a></sup>, <code>ASSERT</code>, <code>ENSURE</code>, etc. to suit your needs and cases.  <a href="https://github.com/clibs/check">check</a> seems to be a minimal, header-only C library with basic assertions macros.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Why strip assertions in non-debug builds?
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<blockquote>
<p>It’s a pointless wastage of CPU cycles, power, etc. to retain assertions in non-debug builds.</p>
</blockquote>
<p>
  A software’s end-user seldom care/know about its technicalities<sup class="footnote-reference"><a id="footnote-reference-5" href="#footnote-5">5</a></sup>.  Oblivious to its design and code, they can’t make sense of a failed assertion’s output — logs, running under debugger, etc.  Contrastingly, programmers (and testers) specifically run debug builds just to catch a failing assumption early on.  Stripping of assertions is one of the reasons<sup class="footnote-reference"><a id="footnote-reference-6" href="#footnote-6">6</a></sup> why debug builds are slow and non-debug builds are fast — lesser <code>if</code> checks/branches.</p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
Comparison
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<table>
<thead>
<tr>
<th>Issue</th>
<th>Source</th>
<th>When</th>
<th>Check</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Error</td>
<td>External</td>
<td>Runtime</td>
<td><code>if</code>, <code>try-catch</code></td>
<td><code>if (bad_handle) { … }</code></td>
</tr>
<tr>
<td>Bug</td>
<td>Internal</td>
<td>Development Time</td>
<td>Assertion macros</td>
<td><code>ENSURE(valid_count)</code></td>
</tr>
</tbody>
</table>
<p>
Key difference is <em>source</em>: errors are due to the environment, user, etc.  You simply have to check for them at runtime.  However, assertions are to check your subsystems (module, function, component, etc.) for buggy code.  This is when some expected state isn’t reached or some condition or invariant isn’t met.  This is internal, within developer’s control.  They can be avoided before the program hits the end-user by the programmer checking what broke the assumption.</p>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
Example with VLC
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<p>
Let’s say we’re developers of the popular media player <a href="https://videolan.org/">VLC</a>.  Checking for a bad/corrupt input (avi/mkv file) should be done with a good ‘ol <code>if</code> that works at runtime.</p>
<p>
However, whether VLC’s own source filter<sup class="footnote-reference"><a id="footnote-reference-7" href="#footnote-7">7</a></sup> is always feeding normalized float data (within <code>[0, 1]</code>) to its decoding filter<sup class="footnote-reference"><a id="footnote-reference-8" href="#footnote-8">8</a></sup> is something to be checked by an assert; checking this with a runtime <code>if</code> in Release builds would be a waste of end-user CPU’s time and energy.</p>
<blockquote>
<p>Though a plain <code>if</code> also works as an assertion, a good programmer would use the right tool for the right job.</p>
</blockquote>
</div>
</div>
<div id="outline-container-headline-7" class="outline-2">
<h2 id="headline-7">
Footnotes
</h2>
</div>
<div class="footnotes">
<hr class="footnotes-separatator">
<div class="footnote-definitions">
<div class="footnote-definition">
<sup id="footnote-1"><a href="#footnote-reference-1">1</a></sup>
<div class="footnote-body">
<p>The unspotted failed assumptions eventually become bugs; hopefully reported by an annoyed (but sincere) end-user.</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-2"><a href="#footnote-reference-2">2</a></sup>
<div class="footnote-body">
<p><a href="https://stackoverflow.com/q/367884/183120">Non-debug builds</a> generally have optimizations turned on and debug information stripped.  <em>Release</em> builds, published to end-user, is a common example.</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-3"><a href="#footnote-reference-3">3</a></sup>
<div class="footnote-body">
<p>Different compilers have different ways of invoking the debugger; MSVC has <code>DebugBreak</code>, GCC on POSIX systems have <code>raise(SIGTRAP)</code>; <a href="https://github.com/nemequ/portable-snippets/tree/master/debug-trap">platform-independant abstractions</a> are available too.</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-4"><a href="#footnote-reference-4">4</a></sup>
<div class="footnote-body">
<p>To denote a check that works only in the <em>Debug</em> build configuration.</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-5"><a href="#footnote-reference-5">5</a></sup>
<div class="footnote-body">
<p>A technical end-user can always build the debug version of an open-source software.  With closed source software, you’re at the mercy of a corporation  to offer debug builds.</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-6"><a href="#footnote-reference-6">6</a></sup>
<div class="footnote-body">
<p>Others include higher optimization levels, linking to non-debug builds of dependencies, etc.</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-7"><a href="#footnote-reference-7">7</a></sup>
<div class="footnote-body">
<p>Component feeding data to the decoder.</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-8"><a href="#footnote-reference-8">8</a></sup>
<div class="footnote-body">
<p>Component processing data before sending to sink (display/speakers).</p>
</div>
</div>
</div>
</div>

</div>

        <footer class="post-footer clearfix">
        <p class="post-tags">
            <span>Tagged:</span>
                <a href="/tags/tech/">tech</a>, 
                <a href="/tags/language/">language</a>, 
                <a href="/tags/c&#43;&#43;/">c&#43;&#43;</a>
        </p>
    <div class="share">
            <a class="icon-twitter" href="https://twitter.com/share?text=Assertions%20vs%20if%20checks&url=https%3a%2f%2flegends2k.github.io%2fnote%2fassert_vs_if%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" aria-label="Share on Twitter">
                <i class="fa fa-twitter" aria-hidden="true"></i>
            </a>
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2flegends2k.github.io%2fnote%2fassert_vs_if%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" aria-label="Share on Facebook">
                <i class="fa fa-facebook" aria-hidden="true"></i>
            </a>
            <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Assertions%20vs%20if%20checks&url=https%3a%2f%2flegends2k.github.io%2fnote%2fassert_vs_if%2f&summary=Two%20completely%20unrelated%20concepts"
               onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;" aria-label="Share on LinkedIn">
               <i class="fa fa-linkedin" aria-hidden="true"></i>
            </a>
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Bits of Insight" href="https://legends2k.github.io/"><i class="fa fa-home"></i></a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-double-up"></i>
                    </a>
                </div>

                <p class="footer-copyright"><a title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a></p>
                <p class="footer-copyright"><span>Rendered by <a href="https://gohugo.io/">Hugo</a></span></p>
                <p class="footer-copyright"><span>Composed with <a href="https://www.gnu.org/software/emacs/">GNU Emacs</a></span></p>
                <p class="footer-copyright">Occured to <a href="https://legends2k.github.io/about/">Sundaram Ramaswamy</a></span></p>
            </div>
        </footer>

        <script src="https://legends2k.github.io/js/jquery-1.11.3.min.js"></script>
        <script src="https://legends2k.github.io/js/jquery.fitvids.js"></script>
        <script src="https://legends2k.github.io/js/scripts.js"></script>
    </body>
</html>

